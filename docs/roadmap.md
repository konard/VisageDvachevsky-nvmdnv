# Дорожная карта разработки NovelMind

> **См. также**: [IMPLEMENTATION_ROADMAP.md](IMPLEMENTATION_ROADMAP.md) — детальные статусы реализации GUI.
> **См. также**: [EDITOR_SPEC_100.md](EDITOR_SPEC_100.md) — критерии 100% готовности редактора.

Данный документ описывает фазы разработки движка и редактора NovelMind.

## Фаза 1: Фундамент

**Цель**: Создание базового каркаса runtime и инфраструктуры разработки.

### 1.1 Настройка проекта
- Структура репозитория и система сборки
- Стандарты кодирования и шаблоны документации
- Настройка конвейера CI/CD
- Настройка среды разработки

### 1.2 Абстракция платформы
- Интерфейс управления окнами
- Абстракция обработки ввода
- Таймер и утилиты времени
- Абстракция файловой системы
- Система логирования

### 1.3 Базовая инфраструктура
- Типы Result/Error для обработки ошибок
- Утилиты управления памятью
- Утилиты строк и кодирования
- Система конфигурации

## Фаза 2: Виртуальная файловая система

**Цель**: Реализация безопасной инфраструктуры загрузки ресурсов.

### 2.1 Ядро VFS
- Интерфейс виртуальной файловой системы
- Отображение идентификаторов ресурсов
- Файловая система в памяти (для тестирования)
- Слой кеширования ресурсов

### 2.2 Поддержка Pack-файлов
- Чтение pack-файлов
- Парсинг таблицы ресурсов
- Поддержка потоковой передачи для больших ресурсов

### 2.3 Уровень безопасности
- Шифрование AES-256-GCM
- Формирование и хранение ключей
- Проверка целостности

## Фаза 3: Система рендеринга

**Цель**: Построение конвейера 2D-рендеринга.

### 3.1 Ядро рендерера
- Настройка бэкенда SDL2/OpenGL
- Управление контекстом рендеринга
- Обработка буфера кадров

### 3.2 Рендеринг спрайтов
- Загрузка и управление текстурами
- Батчинг спрайтов
- Атласы текстур
- Режимы смешивания и эффекты

### 3.3 Рендеринг текста
- Интеграция FreeType
- Загрузка и кеширование шрифтов
- Движок компоновки текста
- Поддержка Unicode

### 3.4 Визуальные эффекты
- Переходы затухания
- Сотрясение экрана
- Цветокоррекция
- Поддержка пользовательских шейдеров

## Фаза 4: Движок скриптов

**Цель**: Реализация языка NM Script и интерпретатора.

### 4.1 Дизайн языка
- Финализация грамматики NM Script
- Дизайн формата байт-кода
- Определение стандартной библиотеки

### 4.2 Компилятор
- Лексер и токенизатор
- Парсер и генерация AST
- Семантический анализ
- Генерация байт-кода

### 4.3 Runtime
- Реализация виртуальной машины
- Выполнение инструкций
- Управление переменными
- Привязки нативных функций

### 4.4 Интеграция
- Коллбэки команд движка
- Выполнение в стиле корутин
- Обработка ошибок и отладка

## Фаза 5: Система сцен

**Цель**: Построение графа сцен и управления объектами.

### 5.1 Граф сцен
- Система слоев (фон, персонажи, UI, эффекты)
- Иерархия объектов
- Видимость и отсечение

### 5.2 Объекты сцены
- Объекты спрайтов
- Текстовые метки
- UI панели
- Анимированные объекты

### 5.3 Переходы
- Загрузка/выгрузка сцен
- Эффекты переходов
- Поддержка кросс-фейда

## Фаза 6: Движок истории

**Цель**: Реализация систем геймплея визуальной новеллы.
**Статус**: Выполнено.

### 6.1 Система диалогов
- Отображение текста с эффектом печатной машинки
- Таблички с именами персонажей
- Множественные стили диалогов

### 6.2 Система выбора
- Рендеринг меню выбора
- Обработка ветвления
- Условные выборы

### 6.3 Управление состоянием
- Отслеживание флагов и переменных
- Оценка условий
- Сохранение состояния (снимки runtime, восстановление диалога/выборов)

## Фаза 7: Аудиосистема

**Цель**: Добавление поддержки звука и музыки.
**Статус**: Выполнено.

### 7.1 Аудио бэкенд
- Интеграция miniaudio (SDL/OpenGL runtime)
- Декодирование аудиоформатов
- Управление громкостью

### 7.2 Звуковые эффекты
- Воспроизведение звука
- Позиционный звук (опционально)
- Пулы звуков

### 7.3 Музыкальная система
- Воспроизведение фоновой музыки
- Кросс-фейдинг
- Точки зацикливания

## Фаза 8: Система сохранения/загрузки

**Цель**: Реализация сохранения состояния игры.
**Статус**: Выполнено (формат v2, совместим с v1).

### 8.1 Сериализация
- Создание снимков состояния
- Бинарный формат сериализации
- Сжатие (zlib)

### 8.2 Слоты сохранения
- Управление файлами сохранений
- Метаданные слотов (временная метка, миниатюра)
- Поддержка автосохранения

### 8.3 Безопасность
- Целостность файлов сохранений
- Опциональное шифрование (AES-256-GCM)
- Обнаружение подмены

## Фаза 9: Локализация

**Цель**: Добавление поддержки нескольких языков.
**Статус**: Выполнено.

### 9.1 Управление строками
- Загрузка таблиц строк
- Переключение языка
- Обработка откатов

### 9.2 Форматирование текста
- Интерполяция переменных
- Формы множественного числа
- Поддержка текста справа налево

## Фаза 10: Визуальный редактор ✅ (Фазы 0-5.0 выполнены)

**Цель**: Построение визуального инструмента авторинга.

**Статус**: Реализован GUI на основе Qt 6 Widgets с профессиональным UX/DX.
См. `docs/gui_architecture.md` и `docs/gui-assessment.md` для деталей.

### 10.1 Фреймворк редактора ✅ **ВЫПОЛНЕНО**
- ✅ UI на основе Qt 6 Widgets (темная тема, в стиле Unreal)
- ✅ Управление проектами (экран приветствия, недавние проекты)
- ✅ Браузер ресурсов (просмотр дерева/списка, поиск, фильтры)
- ✅ 12 полнофункциональных панелей
- ✅ Event Bus, Selection System, Undo/Redo
- ✅ Play-In-Editor с отладкой (Фаза 5.0)

### 10.2 Редактор сцен ⚠️ **ЧАСТИЧНО**
- ✅ Панель SceneView с QGraphicsView
- ✅ Панорамирование (средняя кнопка мыши) и зум (колесо прокрутки)
- ✅ Наложение сетки
- ✅ Inspector с полным редактированием свойств (Фаза 2.2 завершена - String, Int, Float, Bool, Color, Enum)
- ✅ WYSIWYG превью (SceneGraph + runtime snapshot)
- ✅ Размещение объектов (SceneView)
- ⏳ Управление слоями (ожидает архитектуру сцены)
- ✅ Превью воспроизведения (Play-In-Editor + runtime)

### 10.3 Редактор потока истории ✅ **ВЫПОЛНЕНО** (Фаза 3.3)
- ✅ Визуализация графа узлов (QGraphicsView/Scene)
- ✅ Панорамирование и зум
- ✅ Индикаторы точек останова (красные круги)
- ✅ Подсветка выполнения (зеленое свечение)
- ✅ Контекстное меню (переключение точки останова, редактирование, удаление)
- ✅ Создание/удаление узлов (Фаза 3.3 завершена)
- ✅ Палитра узлов с 6 типами узлов (Entry, Dialogue, Choice, Scene, Label, Script)
- ✅ Рисование соединений (Ctrl+Click и перетаскивание)
- ✅ Удаление соединений (Delete/Backspace)
- ✅ Инспектор переменных (панель Debug Overlay)

### 10.4 Редактор скриптов ✅ **ВЫПОЛНЕНО**
- ⏳ Редактирование кода NM Script
- ⏳ Подсветка синтаксиса
- ⏳ Автодополнение
- ⏳ Проверка ошибок

### 10.5 Редактор локализации ✅ **ВЫПОЛНЕНО**
- ✅ Редактор таблицы переводов (ID/Источник/Перевод)
- ✅ Селектор языка
- ✅ Импорт/экспорт (CSV/JSON/PO/XLIFF)
- ✅ Превью перевода

## Фаза 11: Система сборки

**Цель**: Создание конвейера компиляции проектов.

### 11.1 Компилятор ресурсов
- Обработка изображений
- Конвертация аудио
- Растеризация шрифтов
- Компиляция скриптов

### 11.2 Сборщик пакетов
- Упаковка ресурсов
- Шифрование
- Сжатие

### 11.3 Сборщик исполняемых файлов
- Упаковка под конкретную платформу
- Поддержка подписи кода
- Генерация инсталлятора

## Фаза 12: Полировка и оптимизация

**Цель**: Подготовка к промышленному использованию.

### 12.1 Производительность
- Профилирование и оптимизация
- Уменьшение использования памяти
- Улучшение времени загрузки

### 12.2 Качество
- Исправление ошибок
- Обработка крайних случаев
- Сообщения об ошибках

### 12.3 Документация
- Пользовательская документация
- Справочник по API
- Учебники и примеры

## Будущие соображения

Функции для потенциальной будущей разработки:

- **Система плагинов**: Расширяемая архитектура для пользовательских узлов и команд
- **Поддержка мобильных платформ**: Порты для iOS и Android
- **Веб-экспорт**: Runtime на основе WebAssembly для браузера
- **Облачные сохранения**: Онлайн-синхронизация сохранений
- **Достижения**: Интеграция системы достижений
- **Аналитика**: Опциональная телеметрия для игровой аналитики
- **Интеграция Live2D**: Поддержка анимаций персонажей Live2D
- **Воспроизведение видео**: Поддержка видео для катсцен
- **Мини-игры**: Фреймворк для встроенных мини-игр
- **Поддержка модов**: Официальный API для модов и инструменты

## Зависимости

Планируемые к использованию внешние библиотеки:

| Библиотека | Назначение | Лицензия |
|---------|---------|---------|
| SDL2 | Абстракция платформы | zlib |
| OpenGL | Рендеринг | Khronos |
| FreeType | Рендеринг шрифтов | FreeType License |
| stb_image | Загрузка изображений | Public Domain |
| stb_vorbis | Декодирование OGG | Public Domain |
| zlib | Сжатие | zlib |
| OpenSSL/mbedTLS | Шифрование | Apache 2.0/Apache 2.0 |
| Catch2 | Тестирование | BSL-1.0 |
| fmt | Форматирование строк | MIT |
| nlohmann/json | Парсинг JSON | MIT |

## Планирование версий

| Версия | Веха |
|---------|-----------|
| 0.1.0 | Базовый runtime с простым рендерингом |
| 0.2.0 | VFS и управление ресурсами |
| 0.3.0 | Движок скриптов |
| 0.4.0 | Полный движок истории |
| 0.5.0 | Альфа-версия редактора |
| 0.6.0 | Система сборки |
| 0.7.0 | Аудио и сохранение/загрузка |
| 0.8.0 | Бета-версия редактора |
| 0.9.0 | Функционально завершено |
| 1.0.0 | Промышленный релиз |
